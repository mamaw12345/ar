<!DOCTYPE html>
<html>
  <head>
    <title>AR Projectile with Target & Score</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    <style>
      body, html {
        margin: 0;
        overflow: hidden;
        width: 100%;
        height: 100%;
      }
      #scoreboard {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px 15px;
        font-family: sans-serif;
        font-size: 16px;
        z-index: 100;
        border-radius: 6px;
      }
    </style>

    <script>
      AFRAME.registerComponent("projectile-launch", {
        init: function () {
          const el = this.el;
          const scene = document.querySelector("a-scene");
          const target = document.getElementById("target");
          let launched = false;
          let score = 0;

          el.addEventListener("click", () => {
            if (launched) return;
            launched = true;

            let t = 0;
            const g = 9.8;
            const v0 = 4;
            const angle = Math.PI / 4;

            const trailGroup = document.createElement("a-entity");
            scene.appendChild(trailGroup);

            const interval = setInterval(() => {
              t += 0.1;
              const x = v0 * Math.cos(angle) * t;
              const y = v0 * Math.sin(angle) * t - 0.5 * g * t * t;

              if (y < 0) {
                clearInterval(interval);
                launched = false;
                el.setAttribute("position", "0 0.5 0");
                return;
              }

              // Update projectile position
              el.setAttribute("position", `${x} ${y + 0.5} 0`);

              // Add trail dot
              const dot = document.createElement("a-sphere");
              dot.setAttribute("position", `${x} ${y + 0.5} 0`);
              dot.setAttribute("radius", "0.02");
              dot.setAttribute("color", "#00BFFF");
              trailGroup.appendChild(dot);

              // Get world positions
              const ballWorldPos = new THREE.Vector3();
              el.object3D.getWorldPosition(ballWorldPos);

              const targetWorldPos = new THREE.Vector3();
              target.object3D.getWorldPosition(targetWorldPos);

              const dist = ballWorldPos.distanceTo(targetWorldPos);

              if (dist < 0.3) {
                score += 1;
                document.getElementById("score").innerText = score;
                clearInterval(interval);
                launched = false;
                el.setAttribute("position", "0 0.5 0");
              }
            }, 50);
          });
        }
      });
    </script>
  </head>
  <body>
    <!-- Score display -->
    <div id="scoreboard">ðŸŽ¯ Score: <span id="score">0</span></div>

    <!-- A-Frame Scene -->
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      vr-mode-ui="enabled: false"
    >
      <!-- Marker -->
      <a-marker preset="hiro">
        <!-- Ground -->
        <a-plane color="gray" rotation="-90 0 0" width="2" height="2"></a-plane>

        <!-- Ball -->
        <a-sphere
          id="ball"
          radius="0.1"
          color="red"
          position="0 0.5 0"
          projectile-launch
        ></a-sphere>

        <!-- Target -->
        <a-box
          id="target"
          position="2 0.5 0"
          depth="0.3"
          height="0.3"
          width="0.3"
          color="green"
        ></a-box>
      </a-marker>

      <!-- Camera & Cursor -->
      <a-entity camera>
        <a-cursor></a-cursor>
      </a-entity>
    </a-scene>
  </body>
</html>
